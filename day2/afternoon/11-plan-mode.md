# Day 2 下午 - 11. Plan 模式与复杂任务

预计时间：1.5小时

## 📚 学习目标

- [ ] 理解 Plan 模式的工作流程
- [ ] 学习使用 EnterPlanMode 进行任务规划
- [ ] 掌握计划的批准和执行
- [ ] 完成实际练习：规划和实现中等复杂度功能

## 🎯 第一步：理解 Plan 模式

### 什么是 Plan 模式？

Plan 模式是一个专门的工作流程，用于：
- 探索和规划复杂任务
- 设计实现方案
- 获得用户批准后再执行
- 避免盲目修改代码

### 何时使用 Plan 模式？

**✅ 使用 Plan 模式：**
- 添加新功能（影响多个文件）
- 重构模块
- 架构变更
- 不确定实现方案
- 需要多种可行方案

**❌ 不使用 Plan 模式：**
- 简单的 bug 修复
- 单行代码修改
- 明确的任务
- 文件读取

### Plan 模式工作流程

```
1. 进入 Plan 模式
   ↓
2. 探索代码库
   ↓
3. 设计实现方案
   ↓
4. 用户审查和批准
   ↓
5. 退出 Plan 模式
   ↓
6. 执行实现
```

## 🔍 第二步：进入 Plan 模式

### 基本用法

```
进入 Plan 模式规划一个新功能的实现
```

### Plan 模式中的操作

在 Plan 模式下，Claude 会：
1. **探索代码库**：使用 Glob, Grep, Read
2. **分析现有代码**：理解架构和模式
3. **识别关键文件**：找出需要修改的文件
4. **设计实现方案**：提出详细计划
5. **考虑权衡**：分析不同方案的优劣

### Plan 模式的限制

在 Plan 模式下，Claude **不能**：
- ❌ 使用 Edit 工具修改代码
- ❌ 使用 Write 工具创建文件
- ❌ 执行任何破坏性操作

Claude **可以**：
- ✅ 使用 Read 读取文件
- ✅ 使用 Glob 查找文件
- ✅ 使用 Grep 搜索内容
- ✅ 使用 Bash 运行只读命令

### 练习 1: 规划小功能

```
任务：为学习计划添加进度追踪

进入 Plan 模式，规划以下功能：

需求：
- 在每个课程文件中添加完成状态标记
- 创建进度汇总文件
- 生成学习报告
- 支持导出进度

让 Claude：
1. 探索当前结构
2. 设计实现方案
3. 列出需要修改的文件
4. 考虑不同实现方式
5. 提供推荐方案
```

### 练习 2: 规划重构任务

```
任务：重构练习代码组织

进入 Plan 模式，规划重构：

当前问题：
- 练习分散在各个文件中
- 难以跟踪练习完成情况
- 缺少练习验证机制

目标：
1. 集中管理所有练习
2. 添加练习元数据
3. 实现进度跟踪
4. 创建练习索引

让 Claude 设计完整的重构方案。
```

## 📋 第三步：创建计划

### 计划的结构

一个好的计划应该包括：

1. **目标概述**：明确要实现什么
2. **文件清单**：需要创建/修改的文件
3. **实现步骤**：详细的执行步骤
4. **技术决策**：关键技术和方案选择
5. **风险评估**：可能的困难和风险
6. **测试策略**：如何验证功能

### 练习 3: 创建详细计划

```
任务：创建验证系统

进入 Plan 模式，规划练习验证系统：

功能需求：
- 验证练习是否完成
- 检查代码质量
- 提供反馈和建议
- 生成完成报告

让 Claude 创建详细计划，包括：
1. 系统架构设计
2. 文件结构
3. 核心算法
4. 用户交互
5. 扩展性考虑
```

### 练习 4: 多方案比较

```
任务：设计用户认证系统

进入 Plan 模式，让 Claude 提出 2-3 种实现方案：

方案 A：基于 JWT
方案 B：基于 Session
方案 C：第三方 OAuth

让 Claude：
1. 分析各方案优劣
2. 考虑项目实际情况
3. 推荐最合适的方案
4. 说明推荐理由

你做出选择后，再进入详细规划。
```

## ✅ 第四步：审查和批准计划

### 审查清单

在批准计划前，检查：

- [ ] 目标是否清晰？
- [ ] 步骤是否完整？
- [ ] 文件清单是否准确？
- [ ] 技术方案是否合理？
- [ ] 是否考虑了边界情况？
- [ ] 是否有回滚方案？
- [ ] 是否会影响现有功能？

### 修改计划

如果计划不完善：

```
这个计划还需要改进：

1. 添加错误处理策略
2. 考虑向后兼容性
3. 添加更多测试用例
4. 补充文档更新

请更新计划。
```

### 批准计划

计划满意后：

```
批准这个计划，开始实现。
```

### 练习 5: 计划审查

```
任务：审查并改进计划

1. 进入 Plan 模式规划一个功能
2. Claude 生成初始计划
3. 你进行审查：
   - 找出缺失的部分
   - 识别潜在问题
   - 提出改进建议
4. 让 Claude 更新计划
5. 迭代直到计划完善
6. 批准计划

练习批判性思维和计划改进。
```

## 🚀 第五步：执行计划

### 退出 Plan 模式

批准后，Claude 会自动退出 Plan 模式并开始执行。

### 执行阶段

在执行阶段，Claude 会：
1. 按照计划逐步实现
2. 创建新文件
3. 修改现有文件
4. 运行测试
5. 验证功能

### 验证结果

```
验证实现是否符合计划：

1. 检查所有文件是否创建
2. 验证功能是否正常
3. 运行测试套件
4. 对比计划与实际
5. 生成完成报告
```

### 练习 6: 完整流程

```
任务：从规划到实现

选择一个中等复杂度的任务，例如：
"为项目添加日志系统"

完整流程：

1. 进入 Plan 模式
2. 探索代码库
3. 设计方案
4. 创建详细计划
5. 审查和改进计划
6. 批准计划
7. 执行实现
8. 验证结果
9. 生成报告

完整体验 Plan 模式的价值。
```

## 🎯 第六步：复杂项目练习

### 练习 7: CLI 工具开发

```
任务：学习计划 CLI 工具

进入 Plan 模式，规划一个 CLI 工具：

功能：
- 列出所有课程
- 显示课程详情
- 标记课程完成
- 生成学习报告
- 搜索课程内容

让 Claude 规划：
1. 技术栈选择
2. 命令设计
3. 文件结构
4. 实现步骤
5. 测试策略
6. 文档计划

完整实现这个工具。
```

### 练习 8: 插件系统

```
任务：设计扩展系统

进入 Plan 模式，规划插件系统：

需求：
- 支持动态加载插件
- 插件生命周期管理
- 插件间通信
- 配置和选项

让 Claude：
1. 设计插件架构
2. 定义插件接口
3. 规划实现方案
4. 考虑安全性和隔离
5. 提供示例插件

实现基础的插件系统。
```

### 练习 9: 测试框架集成

```
任务：添加测试基础设施

进入 Plan 模式，规划测试系统：

目标：
- 单元测试框架
- 集成测试设置
- 测试覆盖率
- CI/CD 集成

让 Claude 规划：
1. 测试工具选择
2. 测试结构设计
3. Mock 和 fixture 策略
4. 覆盖率目标
5. CI 配置

实现完整的测试基础设施。
```

## 📋 检查点

在继续之前，确保你：

- [ ] 理解 Plan 模式的目的和优势
- [ ] 掌握进入和使用 Plan 模式
- [ ] 能够审查和改进计划
- [ ] 完成了至少 2 个完整规划
- [ ] 理解从规划到执行的完整流程

## 💡 最佳实践

### Plan 模式技巧

**1. 明确需求：**
```
✅ "添加用户认证功能，支持 email 和 GitHub OAuth"
❌ "添加认证"
```

**2. 提供上下文：**
```
✅ "这是一个 Node.js + Express 项目，使用 TypeScript"
❌ (不提供任何背景)
```

**3. 说明约束：**
```
✅ "需要向后兼容，不能破坏现有 API"
✅ "预算有限，优先使用开源工具"
```

### 计划审查技巧

**检查维度：**
- 完整性：是否覆盖所有需求？
- 可行性：技术方案是否可行？
- 风险：是否有充分的风险评估？
- 测试：是否有验证策略？
- 文档：是否包含文档计划？

## 🔧 实用命令

### Plan 模式控制

```
# 进入 Plan 模式
进入 Plan 模式规划任务

# 退出 Plan 模式（不批准）
退出 Plan 模式

# 批准计划
批准计划，开始实现

# 要求更多信息
请补充更多细节
```

## 🚀 下一步

完成本节后，继续学习 [12-project.md](./12-project.md) - 综合实战项目。

## 📝 我的笔记

```bash
# Plan 模式使用记录

# 适合规划的任务：
#
#

# 规划模板：
#
#

# 审查清单：
#
#
```

## 🎓 高级技巧

### 迭代规划

```
大型任务可以分阶段规划：

阶段 1：核心功能
阶段 2：扩展功能
阶段 3：优化和改进

每个阶段单独规划、批准、实现。
```

### 协作规划

```
团队使用 Plan 模式：

1. 技术负责人进入 Plan 模式
2. 创建详细计划
3. 团队审查
4. 讨论和改进
5. 达成共识
6. 批准并分配任务
```

### 计划模板

```
标准化计划格式：

## 目标
[简洁描述]

## 范围
- 包含：[功能列表]
- 不包含：[明确排除的内容]

## 文件
- 新建：[文件列表]
- 修改：[文件列表]
- 删除：[文件列表]

## 步骤
1. [步骤 1]
2. [步骤 2]
...

## 风险
- [风险 1]：[缓解措施]
- [风险 2]：[缓解措施]

## 测试
- [测试策略]
```

## ⚠️ 常见错误

**错误1：规划过度**
```
❌ 为小功能创建复杂计划
✅ 简单任务直接实现
```

**错误2：规划不足**
```
❌ 复杂任务缺乏详细规划
✅ 花时间充分规划
```

**错误3：忽视风险**
```
❌ 不考虑潜在问题
✅ 识别风险和缓解措施
```

**错误4：不沟通**
```
❌ 独自规划不告知团队
✅ 让相关人员参与审查
```

## 🏆 综合挑战

```
挑战：完整产品开发

使用 Plan 模式开发一个完整产品：

产品：学习进度追踪系统

功能：
- 课程管理
- 进度跟踪
- 统计报告
- 数据导出
- 目标设定

流程：

1. 第一阶段（规划）
   - 进入 Plan 模式
   - 需求分析
   - 架构设计
   - 技术选型
   - 实现计划

2. 第二阶段（审查）
   - 详细审查计划
   - 风险评估
   - 资源评估
   - 时间估算

3. 第三阶段（执行）
   - 按计划实现
   - 持续测试
   - 文档编写

4. 第四阶段（验证）
   - 功能测试
   - 性能测试
   - 用户测试
   - 改进迭代

完整体验从0到1的开发流程。
```

## 📖 参考资源

- Plan 模式官方文档
- 软件架构设计原则
- 项目规划最佳实践
- 技术决策框架
