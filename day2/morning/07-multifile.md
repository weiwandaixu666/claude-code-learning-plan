# Day 2 上午 - 7. 多文件操作与项目管理

预计时间：1.5小时

## 📚 学习目标

- [ ] 掌握跨文件引用和修改的技巧
- [ ] 学习理解项目结构
- [ ] 掌握批量文件操作方法
- [ ] 完成实际练习：多文件重构

## 🌳 第一步：理解项目结构

### 项目结构模式

**典型的项目结构：**

```
project/
├── src/              # 源代码
│   ├── components/   # 组件
│   ├── utils/        # 工具函数
│   └── services/     # 服务层
├── tests/            # 测试文件
├── docs/             # 文档
├── config/           # 配置文件
└── package.json      # 项目配置
```

### 分析项目结构

```
任务：分析项目结构

1. 使用 Glob 查看所有目录
2. 读取 package.json 或配置文件
3. 识别主要的代码模块
4. 绘制项目结构图
5. 说明各模块的职责
```

### 练习 1: 项目结构分析

```
任务：深度分析项目

1. 探索整个 learn/ 目录
2. 识别：
   - 主要模块和功能
   - 依赖关系
   - 配置文件
   - 文档位置
3. 创建项目结构文档
4. 标注关键文件和目录
5. 说明如何导航项目
```

## 🔗 第二步：跨文件引用和修改

### 依赖分析

**查找导入关系：**

```
找出所有导入语句，分析模块依赖
```

**反向依赖：**

```
找出哪些文件导入了特定模块
```

### 练习 2: 依赖关系图

```
任务：绘制依赖图

1. 选择一个项目目录（如 day1/）
2. 查找所有 import/require 语句
3. 分析模块之间的依赖关系
4. 创建依赖关系图
5. 识别：
   - 核心模块
   - 独立模块
   - 循环依赖
   - 未使用的导入
```

### 练习 3: 跨文件重构

```
任务：提取通用功能

1. 读取 day1/afternoon/ 下的所有文件
2. 查找重复代码
3. 创建共享工具模块
4. 更新所有引用
5. 确保没有破坏功能

要求：
- 保持向后兼容
- 添加迁移说明
- 更新相关文档
```

## 📦 第三步：批量文件操作

### 批量搜索和替换

**查找所有文件：**

```
使用 Glob 找到所有 .md 文件
```

**批量修改：**

```
在所有 .md 文件中将 "Claude" 改为 "Claude Code"
```

### 练习 4: 批量文档更新

```
任务：统一文档格式

1. 读取所有 day1/ 下的 .md 文件
2. 检查格式一致性：
   - 标题层级
   - 代码块语言
   - 列表格式
   - 链接格式
3. 统一格式
4. 验证所有文件可正常渲染
5. 生成格式规范文档
```

### 练习 5: 批量代码更新

```
任务：API 变更迁移

假设我们需要更新一个 API：

1. 找出所有调用旧 API 的文件
2. 列出所有需要更新的位置
3. 创建迁移脚本
4. 逐个更新文件
5. 运行测试验证
6. 回滚方案

API 变更：
- 旧: client.getData()
- 新: client.fetchData()
```

## 🎯 第四步：多文件重构项目

### 练习 6: 大型重构任务

```
任务：模块化重构

1. 选择一个包含多个文件的项目
2. 分析当前结构：
   - 识别高耦合的模块
   - 找出可以提取的通用功能
   - 评估模块职责

3. 设计新结构：
   - 定义清晰的模块边界
   - 规划模块接口
   - 设计依赖关系

4. 执行重构：
   - 创建新模块
   - 迁移代码
   - 更新引用
   - 添加测试

5. 验证：
   - 功能测试
   - 集成测试
   - 性能对比

6. 文档：
   - 更新架构文档
   - 添加迁移指南
   - 记录 breaking changes
```

### 练习 7: 配置文件管理

```
任务：统一配置管理

1. 查找所有配置文件：
   - .env
   - config/*.json
   - package.json
   - tsconfig.json
   - .eslintrc

2. 分析配置结构：
   - 识别重复配置
   - 找出不一致的地方
   - 评估配置层次

3. 设计配置方案：
   - 环境变量管理
   - 配置文件结构
   - 配置验证
   - 默认值设置

4. 实现配置管理：
   - 创建配置管理器
   - 支持多环境
   - 添加配置验证
   - 编写配置文档

5. 迁移现有配置
```

## 🏗️ 第五步：项目架构设计

### 练习 8: 设计新项目结构

```
任务：创建项目架构

为一个新项目设计架构：

项目需求：
- RESTful API 服务
- 数据库集成
- 认证授权
- 日志系统
- 测试框架
- 文档生成

1. 设计目录结构
2. 定义模块职责
3. 规划数据流
4. 设计分层架构
5. 创建项目骨架

生成：
- 目录结构
- README.md
- 架构文档
- 开发规范
- 启动指南
```

## 📋 检查点

在继续之前，确保你：

- [ ] 能够分析复杂的项目结构
- [ ] 掌握跨文件操作的方法
- [ ] 能够进行批量文件操作
- [ ] 理解模块化和依赖管理
- [ ] 完成了至少 2 个多文件练习

## 💡 最佳实践

### 项目结构原则

1. **按功能分层**
   ```
   ✅ src/
      ├── auth/
      ├── users/
      └── products/

   ❌ src/
      ├── controllers/
      ├── models/
      └── routes/
   ```

2. **保持扁平**
   ```
   ✅ src/utils/date.js
   ❌ src/utils/helpers/date/operations.js
   ```

3. **明确职责**
   ```
   每个模块应该只有一个改变的理由
   ```

### 依赖管理原则

- **依赖倒置**：高层模块不依赖低层模块
- **接口隔离**：不依赖不需要的接口
- **单一职责**：一个模块只做一件事
- **开闭原则**：对扩展开放，对修改关闭

## 🔧 实用工具

### 依赖分析命令

```bash
# JavaScript
npx depcheck
npx madge --circular --extensions ts,tsx

# Python
pip install pipdeptree
pipdeptree

# 通用
grep -r "import\|require" src/
```

### 结构可视化

```
让 Claude Code 创建：
1. 目录树
2. 依赖关系图
3. 模块关系图
4. 数据流图
```

## 🚀 下一步

完成本节后，继续学习 [08-task-tool.md](./08-task-tool.md) - Task 工具与代理系统。

## 📝 我的笔记

```bash
# 多文件操作技巧
#
#

# 项目结构模式
#
#
```

## 🎓 高级技巧

### 渐进式重构

```
不要一次性重写整个项目：

1. 第一步：提取共享模块
2. 第二步：解耦核心逻辑
3. 第三步：统一接口设计
4. 第四步：优化数据流
5. 第五步：完善测试
```

### 向后兼容策略

```
在重构时保持兼容性：

1. 保留旧接口
2. 添加弃用警告
3. 提供迁移工具
4. 更新文档
5. 设置过渡期
```

## ⚠️ 常见陷阱

**陷阱1：过度抽象**
```
❌ 为了可能的未来需求创建复杂抽象
✅ YAGNI - You Aren't Gonna Need It
```

**陷阱2：循环依赖**
```
❌ A 依赖 B，B 又依赖 A
✅ 重新设计，提取共同依赖
```

**陷阱3：大爆炸重构**
```
❌ 一次性修改所有文件
✅ 小步前进，持续集成
```

## 🏆 挑战任务

```
挑战：完整项目重构

重构 projects/mini-app（假设存在）：

要求：
1. 分析现有结构
2. 设计新架构
3. 分阶段迁移
4. 保持所有测试通过
5. 性能不能降低
6. 完整的迁移文档

评估标准：
- 代码质量
- 架构清晰度
- 可维护性
- 文档完整性
```
