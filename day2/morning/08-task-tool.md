# Day 2 上午 - 8. Task 工具与代理系统

预计时间：1.5小时

## 📚 学习目标

- [ ] 理解 Task 工具的工作原理
- [ ] 学习使用 Explore 代理探索代码库
- [ ] 学习使用 Plan 代理设计实现方案
- [ ] 完成实际练习：代理协作任务

## 🤖 第一步：理解 Task 工具

### 什么是 Task 工具？

Task 工具允许你启动专门的代理（subagent）来处理特定的复杂任务。每个代理类型都有专门的工具和能力。

### 代理类型

| 代理 | 用途 | 工具访问 |
|------|------|----------|
| **Explore** | 快速探索代码库 | Glob, Grep, Read, Bash |
| **Plan** | 设计实现方案 | 所有工具（不能执行修改） |
| **general-purpose** | 通用研究和任务 | 所有工具 |
| **Bash** | 命令执行专家 | Bash |

### 何时使用 Task 工具？

**✅ 使用 Task 工具：**
- 需要探索大型代码库
- 复杂的多步骤任务
- 需要并发执行多个任务
- 不确定具体的文件位置

**❌ 不使用 Task 工具：**
- 读取已知路径的单个文件 → 用 Read
- 搜索特定的类定义 → 用 Glob
- 搜索单个文件中的代码 → 用 Read/Grep

## 🔍 第二步：Explore 代理

### Explore 代理特点

- **快速探索**：专门优化用于代码库探索
- **三种深度级别**：quick, medium, very thorough
- **智能搜索**：使用 Glob 和 Grep 组合
- **上下文理解**：能理解代码结构和关系

### 使用 Explore 代理

**基本用法：**

```
使用 Explore 代理分析这个项目的架构
使用 "medium" 深度级别
```

**指定探索范围：**

```
让 Explore 代理找出所有与认证相关的文件
在 day1/ 和 day2/ 目录中搜索
```

### 练习 1: 代码库探索

```
任务：探索学习计划项目

使用 Explore 代理（medium 深度）：

1. 找出所有 Markdown 文件的位置
2. 识别主要的代码模块
3. 分析项目的组织结构
4. 找出所有练习和示例
5. 总结项目特点

让 Explore 代理完成这个探索任务。
```

### 练习 2: 功能定位

```
任务：查找特定功能

使用 Explore 代理（quick 深度）：

1. 找出所有提到 "Git" 的内容
2. 定位所有代码练习
3. 查找所有配置文件
4. 识别未完成的部分

让 Explore 代理快速定位这些内容。
```

### 练习 3: 深度分析

```
任务：深度代码分析

使用 Explore 代理（very thorough 深度）：

1. 分析 day1/ 目录的所有内容
2. 识别所有教学主题
3. 找出所有的代码示例
4. 分析练习的难度递进
5. 评估内容的完整性

让 Explore 代理进行全面分析。
```

## 📋 第三步：Plan 代理

### Plan 代理特点

- **架构设计**：专注于实现方案设计
- **不能执行修改**：只做研究和规划
- **考虑权衡**：分析不同方案的优劣
- **识别关键文件**：找出需要修改的文件

### 使用 Plan 代理

**设计实现方案：**

```
使用 Plan 代理设计一个新功能的实现方案：

功能：为项目添加进度跟踪系统
需求：
- 记录学习进度
- 生成进度报告
- 导出学习记录

让 Plan 代理：
1. 分析需求
2. 设计实现方案
3. 识别需要修改的文件
4. 考虑技术权衡
5. 提供实施步骤
```

### 练习 4: 功能设计

```
任务：设计新功能

使用 Plan 代理：

为一个学习计划管理工具设计实现方案：

功能需求：
1. 用户可以创建学习计划
2. 跟踪每个主题的完成状态
3. 生成学习报告
4. 设置提醒和目标

技术要求：
- 使用 Claude Code 进行开发
- 命令行界面
- 本地数据存储
- 支持 Markdown 格式

让 Plan 代理设计完整的实现方案。
```

### 练习 5: 重构方案

```
任务：重构规划

使用 Plan 代理：

假设需要重构这个学习计划项目：

目标：
1. 模块化结构
2. 更好的可扩展性
3. 添加练习验证系统
4. 支持多种学习路径

让 Plan 代理：
1. 分析当前结构
2. 设计新架构
3. 规划迁移策略
4. 识别风险和挑战
5. 提供实施路线图
```

## 🎯 第四步：代理协作

### 并发执行

你可以同时启动多个代理：

```
任务：并行分析

同时启动三个 Explore 代理：
1. 代理 A：分析 day1/ 内容
2. 代理 B：分析 day2/ 内容
3. 代理 C：分析 exercises/ 内容

让它们并行运行，然后汇总结果。
```

### 顺序执行

某些任务需要顺序执行：

```
步骤 1：使用 Explore 代理探索项目
步骤 2：基于探索结果，使用 Plan 代理设计方案
步骤 3：执行实现
```

### 练习 6: 完整代理工作流

```
任务：从探索到实现

阶段 1 - 探索：
使用 Explore 代理（medium）找出项目中所有与"练习"相关的内容

阶段 2 - 规划：
基于探索结果，使用 Plan 代理设计一个练习验证系统的实现方案

阶段 3 - 执行：
根据方案实现练习验证功能

要求：
- 验证练习是否完成
- 检查代码质量
- 提供反馈和改进建议
- 生成完成报告
```

## 🎓 第五步：高级代理使用

### general-purpose 代理

用于复杂、开放式的任务：

```
使用 general-purpose 代理：

研究和实现：
1. 搜索当前最佳的 CLI 工具实践
2. 找出相关的 npm 包
3. 设计项目结构
4. 实现核心功能
5. 编写文档
```

### 自定义代理提示

```
启动 Explore 代理，使用自定义提示：

"探索 day1/ 目录，重点找出：
- 所有涉及文件操作的练习
- Git 相关的内容
- 测试和调试的例子

使用 medium 深度，提供详细的发现列表"
```

### 练习 7: 自定义代理任务

```
任务：研究型任务

使用 general-purpose 代理：

任务：研究和推荐学习路径

1. 分析当前学习计划的结构
2. 识别学习主题之间的关系
3. 找出可能的改进点
4. 推荐额外的高级主题
5. 设计进阶学习路径

让代理进行全面研究并提供详细报告。
```

## 📋 检查点

在继续之前，确保你：

- [ ] 理解 Task 工具和代理系统
- [ ] 能够使用 Explore 代理探索代码库
- [ ] 能够使用 Plan 代理设计方案
- [ ] 理解何时使用不同类型的代理
- [ ] 完成了至少 3 个代理练习

## 💡 最佳实践

### 选择合适的深度

- **quick**：快速查找，已知大致位置
- **medium**：一般探索，默认选择
- **very thorough**：全面分析，大型项目

### 代理选择指南

```
需要找文件？ → Explore 代理（quick/medium）
需要设计方案？ → Plan 代理
需要执行任务？ → general-purpose 代理
需要运行命令？ → Bash 代理
```

### 并发策略

```
可以并行的任务：
- 探索不同目录
- 运行独立测试
- 分析不同模块

必须串行的任务：
- 有依赖关系的步骤
- 需要前一步结果的任务
```

## 🔧 实用命令

### 查看任务状态

```
查看所有后台任务的状态
```

### 获取任务输出

```
获取特定任务的完整输出
```

### 停止任务

```
停止运行中的后台任务
```

## 🚀 下一步

完成本节后，继续学习 [09-mcp.md](./09-mcp.md) - MCP 服务器与扩展功能。

## 📝 我的笔记

```bash
# 代理使用场景

# Explore 代理用于：
#
#

# Plan 代理用于：
#
#

# 并发执行示例：
#
#
```

## ⚠️ 常见错误

**错误1：过度使用代理**
```
❌ 用 Explore 代理查找单个文件
✅ 用 Glob 或直接 Read
```

**错误2：深度级别选择不当**
```
❌ 大型项目用 quick 深度
❌ 小项目用 very thorough 深度
✅ 根据项目大小选择合适深度
```

**错误3：不查看代理输出**
```
❌ 启动代理后不检查结果
✅ 使用 TaskOutput 工具查看结果
```

## 🎓 高级技巧

### 组合使用代理

```
复杂任务可以分解：

1. Explore 代理：找出相关文件
2. Read 工具：读取关键文件
3. Plan 代理：设计实现方案
4. 执行：根据方案实现
5. 测试：验证功能
```

### 迭代优化

```
使用代理进行迭代改进：

第一轮：让 Explore 代理找出问题
第二轮：让 Plan 代理设计改进方案
第三轮：执行改进
第四轮：验证结果
```

## 🏆 综合挑战

```
挑战：代理协作项目

使用代理系统完成以下任务：

1. 启动 Explore 代理分析整个项目
2. 基于分析结果，启动 Plan 代理设计改进方案
3. 并行启动多个 Explore 代理探索不同方面
4. 汇总所有代理的发现
5. 生成综合分析报告

要求：
- 使用至少 3 个不同的代理
- 至少一次并行执行
- 详细的任务协调
- 完整的结果汇总
```
