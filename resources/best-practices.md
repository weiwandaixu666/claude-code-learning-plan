# Claude Code 最佳实践指南

## 📋 目录

1. [代码编辑最佳实践](#代码编辑最佳实践)
2. [对话技巧](#对话技巧)
3. [项目管理](#项目管理)
4. [性能优化](#性能优化)
5. [安全考虑](#安全考虑)
6. [错误处理](#错误处理)
7. [测试策略](#测试策略)

## 代码编辑最佳实践

### ✅ DO's

1. **明确具体的修改**
   ```
   ✅ "在 calculateSum 函数中，将 for 循环改为使用 reduce 方法"
   ✅ "为 add 函数添加参数类型检查"
   ```

2. **提供上下文**
   ```
   ✅ "在 TypeScript 项目中，为这个函数添加类型注解"
   ✅ "遵循项目现有的代码风格"
   ```

3. **保持一致的风格**
   ```
   ✅ "使用与其他函数相同的命名约定"
   ✅ "保持与现有代码一致的缩进和格式"
   ```

4. **增量修改**
   ```
   ✅ 先提取函数
   ✅ 然后添加类型
   ✅ 最后优化性能
   ```

### ❌ DON'Ts

1. **模糊的请求**
   ```
   ❌ "修好这个代码"
   ❌ "改进一下"
   ❌ "让它更好"
   ```

2. **一次性做太多**
   ```
   ❌ "重构整个文件并添加新功能和测试"
   ✅ "先重构核心函数，然后我们再添加其他功能"
   ```

3. **忽略上下文**
   ```
   ❌ 直接说"改成类"（不知道当前结构）
   ✅ "基于当前的函数式实现，评估是否应该改用类"
   ```

## 对话技巧

### 提问的艺术

**好的提问结构：**

```
[背景] + [具体任务] + [约束条件] + [期望输出]

示例：
"我正在开发一个 Node.js 应用（背景）。
需要实现用户认证功能（任务）。
使用 JWT 和 bcrypt（约束）。
请生成包含注册、登录、令牌刷新的完整代码（期望）。"
```

### 上下文管理

1. **利用对话历史**
   ```
   # 第一次请求
   创建一个计算器函数

   # 后续请求（Claude 记得上下文）
   现在为这个函数添加错误处理
   ```

2. **引用之前的内容**
   ```
   基于我们刚才讨论的方案，实现代码
   按照之前的重构计划继续
   ```

3. **确认理解**
   ```
   你理解我的需求了吗？
   在开始之前，确认一下方案
   ```

### 迭代改进

```
第一轮：生成基础版本
→ 反馈：太简单了

第二轮：添加更多功能
→ 反馈：性能不够好

第三轮：优化性能
→ 反馈：很好，就是这个版本
```

## 项目管理

### 项目结构

**推荐的目录结构：**

```
project/
├── src/              # 源代码
│   ├── components/   # 组件
│   ├── utils/        # 工具
│   └── services/     # 服务
├── tests/            # 测试
├── docs/             # 文档
├── exercises/        # 练习
└── resources/        # 资源
```

### 代码组织

1. **按功能分层**
   ```
   ✅ src/
      ├── auth/
      ├── users/
      └── products/

   ❌ src/
      ├── controllers/
      ├── models/
      └── routes/
   ```

2. **保持扁平**
   ```
   ✅ src/utils/date.js
   ❌ src/utils/helpers/date/operations.js
   ```

3. **明确职责**
   ```
   每个模块只有一个改变的理由
   ```

### 依赖管理

1. **避免循环依赖**
   ```
   ❌ A 依赖 B，B 又依赖 A
   ✅ 提取共同依赖 C
   ```

2. **依赖注入**
   ```
   ✅ 传入依赖而不是硬编码
   function service(db = database) { ... }
   ```

3. **最小化依赖**
   ```
   ✅ 只导入需要的部分
   import { specificFunction } from 'library'
   ```

## 性能优化

### 代码生成

1. **生成性能友好的代码**
   ```
   ✅ 使用适当的数据结构
   ✅ 避免不必要的循环
   ✅ 使用惰性求值
   ```

2. **考虑可扩展性**
   ```
   ✅ 设计支持未来增长
   ✅ 添加缓存层
   ✅ 考虑并发处理
   ```

### 工具使用

1. **并行执行**
   ```
   ✅ 同时运行独立命令
   ✅ 并行读取多个文件
   ```

2. **选择性读取**
   ```
   ✅ 只读取需要的文件
   ✅ 使用 Glob 先定位
   ❌ 读取整个项目
   ```

3. **缓存结果**
   ```
   ✅ 保存重复使用的数据
   ✅ 避免重复计算
   ```

## 安全考虑

### 敏感信息

```
❌ 永远不要在命令中包含 API 密钥
❌ 不要在代码中硬编码密码
❌ 不要在对话中分享令牌

✅ 使用环境变量
✅ 使用配置文件（加入 .gitignore）
✅ 使用密钥管理服务
```

### 代码安全

1. **输入验证**
   ```
   ✅ 验证所有用户输入
   ✅ 清理外部数据
   ✅ 使用类型检查
   ```

2. **避免危险操作**
   ```
   ❌ 不要使用 eval()
   ❌ 不要直接拼接 SQL
   ❌ 不要信任客户端数据

   ✅ 使用参数化查询
   ✅ 使用安全的库
   ✅ 实施权限检查
   ```

3. **依赖安全**
   ```
   ✅ 定期更新依赖
   ✅ 运行安全审计
   ✅ 检查已知漏洞
   ```

## 错误处理

### 代码生成

1. **完整的错误处理**
   ```javascript
   ✅ try {
       const result = await operation();
       return result;
     } catch (error) {
       logger.error('Operation failed', { error, context });
       throw new CustomError('Operation failed', error);
     }

   ❌ try {
       const result = await operation();
       return result;
     } catch (e) {
       console.log(e);
     }
   ```

2. **类型安全**
   ```typescript
   ✅ function process(data: string): Result {
       if (!data) throw new Error('Invalid data');
       // ...
     }

   ❌ function process(data) {
       // 没有类型检查
     }
   ```

### 调试策略

1. **系统化调试**
   ```
   1. 复现问题
   2. 收集信息
   3. 形成假设
   4. 验证假设
   5. 修复问题
   6. 预防措施
   ```

2. **使用日志**
   ```
   ✅ 添加有意义的日志
   ✅ 包含上下文信息
   ✅ 使用适当的日志级别
   ```

## 测试策略

### 测试优先

1. **生成可测试的代码**
   ```
   ✅ 纯函数
   ✅ 依赖注入
   ✅ 模块化设计
   ```

2. **生成测试代码**
   ```
   ✅ 为新功能生成测试
   ✅ 包含边界情况
   ✅ 测试错误路径
   ```

### 测试覆盖

```
✅ 单元测试：测试单个函数
✅ 集成测试：测试模块交互
✅ 端到端测试：测试完整流程
✅ 边界测试：测试极限情况
✅ 错误测试：测试错误处理
```

## 工作流最佳实践

### 开发流程

```
1. Plan 模式规划
   ↓
2. 探索代码库
   ↓
3. 设计实现方案
   ↓
4. 审查和批准
   ↓
5. 执行实现
   ↓
6. 测试验证
   ↓
7. 文档更新
   ↓
8. 代码提交
```

### Git 工作流

```
✅ 频繁提交小改动
✅ 清晰的提交信息
✅ 功能分支开发
✅ Pull Request 审查
✅ 持续集成测试
```

### 协作技巧

1. **清晰的沟通**
   ```
   ✅ 明确表达意图
   ✅ 提供足够的上下文
   ✅ 说明约束和偏好
   ```

2. **验证结果**
   ```
   ✅ 检查生成的代码
   ✅ 运行测试验证
   ✅ Code Review 重要更改
   ```

## 学习建议

### 循序渐进

```
1. 从简单任务开始
2. 逐步增加复杂度
3. 学习每个工具的特性
4. 探索高级功能
5. 建立最佳实践
```

### 持续改进

```
✅ 记录有用的命令
✅ 创建自定义技能
✅ 建立工作流模板
✅ 分享经验教训
```

### 问题解决

```
1. 使用 /help
2. 查看文档
3. 搜索类似问题
4. 尝试不同方法
5. 寻求社区帮助
```

## 常见场景

### 场景 1：理解代码

```
1. 使用 Explore 代理分析项目
2. 读取关键文件
3. 让 Claude 解释代码
4. 生成文档和图表
```

### 场景 2：添加功能

```
1. 进入 Plan 模式
2. 设计实现方案
3. 批准后实现
4. 编写测试
5. 更新文档
```

### 场景 3：修复 Bug

```
1. 收集错误信息
2. 分析相关代码
3. 形成假设
4. 修复问题
5. 添加测试
6. 提交更改
```

### 场景 4：重构代码

```
1. 分析现有代码
2. 识别改进点
3. 规划重构方案
4. 增量式重构
5. 持续测试
6. 更新文档
```

## 总结

### 核心原则

1. **明确性** - 清晰表达意图
2. **渐进性** - 小步前进
3. **验证性** - 持续测试
4. **文档化** - 记录决策
5. **安全性** - 考虑风险

### 成功习惯

- ✅ 详细的计划和思考
- ✅ 清晰的沟通
- ✅ 持续的验证
- ✅ 完整的文档
- ✅ 定期的反思
