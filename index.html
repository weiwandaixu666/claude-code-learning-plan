<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¿ Claude Code å­¦ä¹ è®¡åˆ’ ğŸŒ¿</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fff0f5 0%, #ffe4e8 50%, #ffd9e3 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
        }
        header {
            flex-shrink: 0;
            text-align: center;
            padding: 25px 30px;
            background: white;
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(100, 200, 120, 0.15);
            margin-bottom: 20px;
            border: 4px solid #a8e6b8;
        }
        h1 { font-size: 2rem; color: #5cb85c; margin-bottom: 8px; }
        .subtitle { font-size: 1rem; color: #7dd87d; }

        /* æœç´¢ç»“æœ */
        .search-results {
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        .search-result-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid #e8f8ed;
            transition: background 0.2s ease;
        }
        .search-result-item:hover {
            background: #f0fff4;
        }
        .search-result-item:last-child {
            border-bottom: none;
        }
        .search-result-title {
            font-weight: bold;
            color: #5cb85c;
            margin-bottom: 4px;
        }
        .search-result-match {
            background: #fff59d;
            padding: 1px 4px;
            border-radius: 3px;
        }
        .search-result-lesson {
            font-size: 0.85rem;
            color: #7dd87d;
        }
        .search-no-results {
            padding: 20px;
            text-align: center;
            color: #999;
        }
        .search-loading {
            padding: 20px;
            text-align: center;
            color: #7dd87d;
        }

        .progress-container {
            background: #f0fff4;
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0 0;
            border: 3px solid #a8e6b8;
        }
        .progress-bar-bg {
            background: #d4f5dc;
            height: 35px;
            border-radius: 15px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #90ee90, #7dd87d);
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        #progressText {
            text-align: center;
            margin-top: 8px;
            color: #5cb85c;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* æ€»å­¦ä¹ æ—¶é—´ */
        .total-time {
            text-align: center;
            margin-top: 8px;
            color: #7dd87d;
            font-size: 0.85rem;
        }
        .total-time-value {
            font-weight: bold;
            color: #5cb85c;
        }

        /* ä¸¤æ å¸ƒå±€ */
        .main-content {
            display: flex;
            gap: 20px;
        }

        /* å·¦ä¾§è¾¹æ  - è¯¾ç¨‹æ¦‚è§ˆ */
        .sidebar {
            width: 400px;
            flex-shrink: 0;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(100, 200, 120, 0.12);
            border: 4px solid #a8e6b8;
            display: flex;
            flex-direction: column;
            position: sticky;
            top: 20px;
            align-self: flex-start;
            max-height: calc(100vh - 40px);
        }
        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #c8f7dc, #b0f0c8);
            color: #2d7a3e;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
        }
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        .sidebar-content::-webkit-scrollbar { width: 8px; }
        .sidebar-content::-webkit-scrollbar-track { background: #f0fff4; border-radius: 10px; }
        .sidebar-content::-webkit-scrollbar-thumb { background: #a8e6b8; border-radius: 10px; }

        .day-section { margin-bottom: 15px; }
        .day-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f0fff4;
            border-radius: 12px;
            margin-bottom: 10px;
            border: 2px solid #b8f5cc;
        }
        .day-emoji { font-size: 1.8rem; }
        .day-title { font-size: 1.1rem; font-weight: bold; color: #5cb85c; }

        .lesson-item {
            background: #fafdfb;
            border-radius: 12px;
            margin-bottom: 8px;
            border: 2px solid #e8f8ed;
            transition: all 0.3s ease;
        }
        .lesson-item:hover { border-color: #c8f7dc; }
        .lesson-item.active {
            background: linear-gradient(135deg, #b8f5cc, #98f0b8);
            border-color: #7dd87d;
        }
        .lesson-item.active .lesson-title,
        .lesson-item.active .lesson-emoji { color: #2d7a3e; }
        .lesson-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            cursor: pointer;
        }
        .lesson-emoji { font-size: 1.5rem; }
        .lesson-title {
            font-size: 0.95rem;
            font-weight: bold;
            color: #5cb85c;
            flex: 1;
        }
        .lesson-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .study-time {
            font-size: 0.75rem;
            color: #999;
            padding: 2px 6px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        .complete-btn {
            background: linear-gradient(135deg, #c8f7dc, #b0f0c8);
            border: 2px solid #a8e6b8;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
            color: #5cb85c;
            pointer-events: none;
        }
        .complete-btn.completed {
            background: linear-gradient(135deg, #90ee90, #7dd87d);
            color: white;
            border-color: #7dd87d;
        }

        /* å³ä¾§ - å†…å®¹åŒºåŸŸ */
        .content-area {
            flex: 1;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(100, 200, 120, 0.12);
            border: 4px solid #a8e6b8;
            display: flex;
            flex-direction: column;
        }
        .content-header {
            padding: 20px 25px;
            background: linear-gradient(135deg, #c8f7dc, #b0f0c8);
            color: #2d7a3e;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }
        .content-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .content-emoji { font-size: 2.5rem; }
        .content-title { font-size: 1.5rem; font-weight: bold; }
        .mark-complete-btn {
            background: white;
            color: #5cb85c;
            border: 2px solid #a8e6b8;
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .mark-complete-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(120, 220, 140, 0.3);
            background: #f0fff4;
        }
        .mark-complete-btn.completed {
            background: linear-gradient(135deg, #90ee90, #7dd87d);
            color: white;
            border-color: #7dd87d;
        }

        /* è®¡æ—¶æ§åˆ¶æŒ‰é’® */
        .timer-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .timer-btn {
            background: white;
            color: #5cb85c;
            border: 2px solid #a8e6b8;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .timer-btn:hover {
            background: #f0fff4;
            transform: scale(1.05);
        }
        .timer-btn.active {
            background: linear-gradient(135deg, #90ee90, #7dd87d);
            color: white;
            border-color: #7dd87d;
        }
        .timer-status {
            font-size: 0.85rem;
            color: #7dd87d;
            padding: 4px 10px;
            background: #f0fff4;
            border-radius: 10px;
        }

        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            line-height: 1.8;
        }
        .content-body::-webkit-scrollbar { width: 10px; }
        .content-body::-webkit-scrollbar-track { background: #f0fff4; border-radius: 10px; }
        .content-body::-webkit-scrollbar-thumb { background: #a8e6b8; border-radius: 10px; }

        /* å†…å®¹æ ·å¼ */
        .content-body h1 { color: #5cb85c; font-size: 1.8rem; margin: 20px 0 15px; }
        .content-body h2 { color: #5cb85c; font-size: 1.5rem; margin: 18px 0 12px; }
        .content-body h3 { color: #7dd87d; font-size: 1.2rem; margin: 15px 0 10px; }
        .content-body h4 { color: #7dd87d; font-size: 1.1rem; margin: 12px 0 8px; }
        .content-body code {
            background: #f0fff4;
            padding: 2px 8px;
            border-radius: 5px;
            color: #5cb85c;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        .content-body pre {
            background: #2a3a2a;
            padding: 20px;
            border-radius: 12px;
            overflow-x: auto;
            margin: 15px 0;
            border: 2px solid #a8e6b8;
        }
        .content-body pre code {
            background: transparent;
            color: #f8f8f2;
            padding: 0;
            font-size: 0.95rem;
        }
        .content-body p { margin-bottom: 15px; color: #333; }
        .content-body ul, .content-body ol { margin: 15px 0 15px 25px; }
        .content-body li { margin-bottom: 8px; }
        .content-body strong { color: #5cb85c; }
        .content-body blockquote {
            border-left: 4px solid #a8e6b8;
            padding-left: 20px;
            margin: 15px 0;
            color: #666;
            font-style: italic;
        }

        /* æœç´¢é«˜äº® */
        .search-highlight {
            background: #fff59d;
            padding: 2px 4px;
            border-radius: 3px;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #7dd87d;
        }
        .empty-state-emoji { font-size: 5rem; margin-bottom: 20px; }
        .empty-state-text { font-size: 1.3rem; }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #7dd87d;
            font-size: 1.2rem;
        }

        /* è¯¾ç¨‹å†…ç›®å½• */
        .toc-panel {
            position: fixed;
            right: -350px;
            top: 0;
            width: 320px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #a8e6b8;
            transition: right 0.3s ease;
            z-index: 200;
            display: flex;
            flex-direction: column;
        }
        .toc-panel.show { right: 0; }
        .toc-header {
            padding: 20px;
            background: linear-gradient(135deg, #c8f7dc, #b0f0c8);
            color: #2d7a3e;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toc-close {
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .toc-close:hover { opacity: 1; }
        .toc-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        .toc-content::-webkit-scrollbar { width: 6px; }
        .toc-content::-webkit-scrollbar-track { background: #f0fff4; }
        .toc-content::-webkit-scrollbar-thumb { background: #a8e6b8; border-radius: 10px; }
        .toc-item {
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        .toc-item:hover {
            background: #f0fff4;
            border-left-color: #7dd87d;
        }
        .toc-item.active {
            background: #f0fff4;
            border-left-color: #5cb85c;
            color: #5cb85c;
            font-weight: bold;
        }
        .toc-level-1 { padding-left: 15px; font-size: 0.9rem; }
        .toc-level-2 { padding-left: 30px; font-size: 0.85rem; }
        .toc-level-3 { padding-left: 45px; font-size: 0.8rem; }

        /* ç›®å½•æŒ‰é’® */
        .toc-toggle-btn {
            position: fixed;
            right: 0;
            top: 220px;
            width: 50px;
            height: 50px;
            border-radius: 12px 0 0 12px;
            background: linear-gradient(135deg, #c8f7dc, #b0f0c8);
            border: 2px solid #a8e6b8;
            border-right: none;
            color: #2d7a3e;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: -4px 4px 15px rgba(0, 0, 0, 0.15);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .toc-toggle-btn:hover {
            transform: scale(1.05);
            width: 55px;
        }
        .toc-toggle-btn.active {
            right: 320px;
            background: linear-gradient(135deg, #90ee90, #7dd87d);
        }
        .toc-toggle-btn.hidden {
            display: none;
        }

        /* ç¬”è®°é¢æ¿ */
        .notes-panel {
            position: fixed;
            right: -350px;
            top: 0;
            width: 320px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #a8e6b8;
            transition: right 0.3s ease;
            z-index: 200;
            display: flex;
            flex-direction: column;
        }
        .notes-panel.show {
            right: 0;
        }
        .notes-header {
            padding: 20px;
            background: linear-gradient(135deg, #c8f7dc, #b0f0c8);
            color: #2d7a3e;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .notes-close {
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .notes-close:hover { opacity: 1; }
        .notes-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        .notes-content::-webkit-scrollbar { width: 8px; }
        .notes-content::-webkit-scrollbar-track { background: #f0fff4; }
        .notes-content::-webkit-scrollbar-thumb { background: #a8e6b8; border-radius: 10px; }

        /* ç¬”è®°é¡¹ */
        .note-item {
            background: #f9fdf9;
            border: 2px solid #e8f8ed;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
        }
        .note-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: #999;
        }
        .note-text {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #333;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        .note-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        .note-btn {
            flex: 1;
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .note-btn-edit {
            background: #c8f7dc;
            color: #2d7a3e;
        }
        .note-btn-edit:hover {
            background: #b8f5cc;
        }
        .note-btn-delete {
            background: #ffcccc;
            color: #cc0000;
        }
        .note-btn-delete:hover {
            background: #ffaaaa;
        }

        /* æ·»åŠ ç¬”è®°è¡¨å• */
        .note-form {
            background: #f0fff4;
            border: 2px solid #a8e6b8;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .note-textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 2px solid #c8f7dc;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
            outline: none;
        }
        .note-textarea:focus {
            border-color: #7dd87d;
        }
        .note-form-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .note-btn-save {
            background: linear-gradient(135deg, #90ee90, #7dd87d);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            flex: 1;
        }
        .note-btn-save:hover {
            transform: scale(1.02);
        }
        .note-btn-cancel {
            background: #ddd;
            color: #666;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* ç¬”è®°åˆ‡æ¢æŒ‰é’® */
        .notes-toggle-btn {
            position: fixed;
            right: 0;
            top: 150px;
            width: 50px;
            height: 50px;
            border-radius: 12px 0 0 12px;
            background: linear-gradient(135deg, #c8f7dc, #b0f0c8);
            border: 2px solid #a8e6b8;
            border-right: none;
            color: #2d7a3e;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: -4px 4px 15px rgba(0, 0, 0, 0.15);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .notes-toggle-btn:hover {
            transform: scale(1.05);
            width: 55px;
        }
        .notes-toggle-btn.active {
            right: 320px;
            background: linear-gradient(135deg, #90ee90, #7dd87d);
        }

        /* æœç´¢é¢æ¿ */
        .search-panel {
            position: fixed;
            right: -350px;
            top: 0;
            width: 320px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #a8e6b8;
            transition: right 0.3s ease;
            z-index: 200;
            display: flex;
            flex-direction: column;
        }
        .search-panel.show {
            right: 0;
        }
        .search-header {
            padding: 20px;
            background: linear-gradient(135deg, #c8f7dc, #b0f0c8);
            color: #2d7a3e;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .search-close {
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .search-close:hover { opacity: 1; }
        .search-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        .search-content::-webkit-scrollbar { width: 8px; }
        .search-content::-webkit-scrollbar-track { background: #f0fff4; }
        .search-content::-webkit-scrollbar-thumb { background: #a8e6b8; border-radius: 10px; }

        /* æœç´¢è¾“å…¥æ¡† */
        .search-input-wrapper {
            position: relative;
            margin-bottom: 10px;
        }
        .search-input {
            width: 100%;
            padding: 12px 45px 12px 20px;
            border: 2px solid #a8e6b8;
            border-radius: 25px;
            font-size: 1rem;
            background: #f0fff4;
            color: #2d7a3e;
            outline: none;
            transition: all 0.3s ease;
        }
        .search-input:focus {
            border-color: #7dd87d;
            box-shadow: 0 0 0 3px rgba(120, 216, 125, 0.2);
            background: white;
        }
        .search-input::placeholder {
            color: #7dd87d;
        }
        .search-input-wrapper .search-shortcut {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: #d4f5dc;
            color: #5cb85c;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            pointer-events: none;
        }

        /* æœç´¢åˆ‡æ¢æŒ‰é’® */
        .search-toggle-btn {
            position: fixed;
            right: 0;
            top: 80px;
            width: 50px;
            height: 50px;
            border-radius: 12px 0 0 12px;
            background: linear-gradient(135deg, #c8f7dc, #b0f0c8);
            border: 2px solid #a8e6b8;
            border-right: none;
            color: #2d7a3e;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: -4px 4px 15px rgba(0, 0, 0, 0.15);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .search-toggle-btn:hover {
            transform: scale(1.05);
            width: 55px;
        }
        .search-toggle-btn.active {
            right: 320px;
            background: linear-gradient(135deg, #90ee90, #7dd87d);
        }

        /* æ— ç¬”è®°æç¤º */
        .no-notes {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        .no-notes-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        /* å“åº”å¼ */
        @media (max-width: 1000px) {
            .main-content { flex-direction: column; }
            .sidebar { width: 100%; }
        }
        @media (max-width: 1400px) {
            .toc-panel { width: 280px; right: -280px; }
            .toc-toggle-btn.active { right: 280px; }
            .notes-panel { width: 280px; right: -280px; }
            .notes-toggle-btn.active { right: 280px; }
            .search-panel { width: 280px; right: -280px; }
            .search-toggle-btn.active { right: 280px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ¿ Claude Code å­¦ä¹ è®¡åˆ’ ğŸŒ¿</h1>
            <p class="subtitle">âœ¨ ä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·è¿›æ­¥ï¼âœ¨</p>

            <div class="progress-container">
                <div class="progress-bar-bg">
                    <div class="progress-bar" id="progressBar">0%</div>
                </div>
                <p id="progressText">åŠ æ²¹ï¼å¼€å§‹ä½ çš„å­¦ä¹ ä¹‹æ—…å§~ ğŸ’ª</p>
                <div class="total-time">â±ï¸ æ€»å­¦ä¹ æ—¶é—´: <span class="total-time-value" id="totalTime">0å°æ—¶0åˆ†é’Ÿ</span></div>
            </div>
        </header>

        <div class="main-content">
            <!-- å·¦ä¾§ï¼šè¯¾ç¨‹æ¦‚è§ˆ -->
            <div class="sidebar">
                <div class="sidebar-header">ğŸ“š è¯¾ç¨‹ç›®å½•</div>
                <div class="sidebar-content">
                    <div id="lessonList"></div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šè¯¾ç¨‹å†…å®¹ -->
            <div class="content-area">
                <div class="content-header" id="contentHeader">
                    <div class="content-left">
                        <span class="content-emoji">ğŸ‘ˆ</span>
                        <span class="content-title">è¯·é€‰æ‹©å·¦ä¾§è¯¾ç¨‹å¼€å§‹å­¦ä¹ </span>
                    </div>
                </div>
                <div class="content-body" id="contentBody">
                    <div class="empty-state">
                        <div class="empty-state-emoji">ğŸ“–</div>
                        <div class="empty-state-text">ç‚¹å‡»å·¦ä¾§è¯¾ç¨‹æŸ¥çœ‹è¯¦ç»†å†…å®¹</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æœç´¢æŒ‰é’® -->
        <button class="search-toggle-btn" id="searchToggleBtn" onclick="toggleSearch()" title="æœç´¢">ğŸ”</button>

        <!-- ç¬”è®°æŒ‰é’® -->
        <button class="notes-toggle-btn" id="notesToggleBtn" onclick="toggleNotes()" title="å­¦ä¹ ç¬”è®°">ğŸ“</button>

        <!-- ç›®å½•æŒ‰é’® -->
        <button class="toc-toggle-btn" id="tocToggleBtn" onclick="toggleTOC()" title="ç›®å½•">ğŸ“‘</button>

        <!-- ç›®å½•é¢æ¿ -->
        <div class="toc-panel" id="tocPanel">
            <div class="toc-header">
                <span>ğŸ“‘ ç›®å½•</span>
                <span class="toc-close" onclick="toggleTOC()">âœ•</span>
            </div>
            <div class="toc-content" id="tocContent">
                <div style="padding: 15px; text-align: center; color: #999;">æš‚æ— ç›®å½•</div>
            </div>
        </div>

        <!-- ç¬”è®°é¢æ¿ -->
        <div class="notes-panel" id="notesPanel">
            <div class="notes-header">
                <span>ğŸ“ å­¦ä¹ ç¬”è®°</span>
                <span class="notes-close" onclick="toggleNotes()">âœ•</span>
            </div>
            <div class="notes-content" id="notesContent">
                <div class="no-notes">
                    <div class="no-notes-icon">ğŸ“</div>
                    <div>è¿˜æ²¡æœ‰ç¬”è®°å“¦~</div>
                    <div style="font-size: 0.85rem; margin-top: 10px;">é€‰æ‹©è¯¾ç¨‹åæ·»åŠ ç¬”è®°</div>
                </div>
            </div>
        </div>

        <!-- æœç´¢é¢æ¿ -->
        <div class="search-panel" id="searchPanel">
            <div class="search-header">
                <span>ğŸ” æœç´¢è¯¾ç¨‹</span>
                <span class="search-close" onclick="toggleSearch()">âœ•</span>
            </div>
            <div class="search-content">
                <div class="search-input-wrapper">
                    <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢è¯¾ç¨‹å†…å®¹..." autocomplete="off">
                    <span class="search-shortcut">Ctrl+K</span>
                </div>
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>
    </div>

    <script>
        const lessons = [
            { id: '1-1', file: 'day1/morning/01-setup.md', emoji: 'âš™ï¸', title: '01. ç¯å¢ƒå®‰è£…ä¸é…ç½®' },
            { id: '1-2', file: 'day1/morning/02-basics.md', emoji: 'ğŸ“–', title: '02. åŸºç¡€å¯¹è¯ä¸æ–‡ä»¶æ“ä½œ' },
            { id: '1-3', file: 'day1/morning/03-editing.md', emoji: 'âœï¸', title: '03. ä»£ç ç¼–è¾‘åŸºç¡€' },
            { id: '1-4', file: 'day1/afternoon/04-bash.md', emoji: 'ğŸ’»', title: '04. Bash å·¥å…·ä¸å‘½ä»¤æ‰§è¡Œ' },
            { id: '1-5', file: 'day1/afternoon/05-generation.md', emoji: 'ğŸ¤–', title: '05. æ™ºèƒ½ä»£ç ç”Ÿæˆä¸é‡æ„' },
            { id: '1-6', file: 'day1/afternoon/06-debugging.md', emoji: 'ğŸ›', title: '06. è°ƒè¯•ä¸é—®é¢˜è§£å†³' },
            { id: '2-1', file: 'day2/morning/07-multifile.md', emoji: 'ğŸŒ³', title: '07. å¤šæ–‡ä»¶æ“ä½œä¸é¡¹ç›®ç®¡ç†' },
            { id: '2-2', file: 'day2/morning/08-task-tool.md', emoji: 'ğŸ¯', title: '08. Task å·¥å…·ä¸ä»£ç†ç³»ç»Ÿ' },
            { id: '2-3', file: 'day2/morning/09-mcp.md', emoji: 'ğŸ”Œ', title: '09. MCP æœåŠ¡å™¨ä¸æ‰©å±•åŠŸèƒ½' },
            { id: '2-4', file: 'day2/afternoon/10-skills.md', emoji: 'â­', title: '10. æŠ€èƒ½ä¸è‡ªå®šä¹‰å‘½ä»¤' },
            { id: '2-5', file: 'day2/afternoon/11-plan-mode.md', emoji: 'ğŸ“‹', title: '11. Plan æ¨¡å¼ä¸å¤æ‚ä»»åŠ¡' },
            { id: '2-6', file: 'day2/afternoon/12-project.md', emoji: 'ğŸ†', title: '12. ç»¼åˆå®æˆ˜é¡¹ç›®' }
        ];

        let currentLesson = null;
        let loadedLessons = new Set();
        let completedLessons = new Set();
        let lessonContents = {}; // ç¼“å­˜è¯¾ç¨‹å†…å®¹ç”¨äºæœç´¢
        let searchTimeout = null;
        let studyTimes = {}; // æ¯ä¸ªè¯¾ç¨‹çš„å­¦ä¹ æ—¶é•¿ï¼ˆç§’ï¼‰
        let studyStartTime = null; // å½“å‰å­¦ä¹ å¼€å§‹æ—¶é—´
        let totalTimeSpent = 0; // æ€»å­¦ä¹ æ—¶é—´ï¼ˆç§’ï¼‰
        let notes = {}; // è¯¾ç¨‹ç¬”è®° {lessonId: [{id, text, timestamp}]}
        let editingNoteId = null; // æ­£åœ¨ç¼–è¾‘çš„ç¬”è®°ID

        // ä» localStorage åŠ è½½å®ŒæˆçŠ¶æ€
        function loadCompletedState() {
            const saved = localStorage.getItem('completedLessons');
            if (saved) {
                completedLessons = new Set(JSON.parse(saved));
            }
            updateProgress();

            // åŠ è½½å­¦ä¹ æ—¶é—´
            const savedTimes = localStorage.getItem('studyTimes');
            if (savedTimes) {
                studyTimes = JSON.parse(savedTimes);
                totalTimeSpent = Object.values(studyTimes).reduce((a, b) => a + b, 0);
            }
            updateTotalTime();

            // åŠ è½½ç¬”è®°
            loadNotes();
        }

        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            if (hours > 0) {
                return `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
            }
            return `${minutes}åˆ†é’Ÿ`;
        }

        // æ›´æ–°æ€»å­¦ä¹ æ—¶é—´æ˜¾ç¤º
        function updateTotalTime() {
            document.getElementById('totalTime').textContent = formatTime(totalTimeSpent);
        }

        // åŠ è½½ç¬”è®°
        function loadNotes() {
            const saved = localStorage.getItem('studyNotes');
            if (saved) {
                notes = JSON.parse(saved);
            }
        }

        // ä¿å­˜ç¬”è®°
        function saveNotes() {
            localStorage.setItem('studyNotes', JSON.stringify(notes));
        }

        // åˆ‡æ¢ç¬”è®°é¢æ¿æ˜¾ç¤º
        function toggleNotes() {
            const panel = document.getElementById('notesPanel');
            const btn = document.getElementById('notesToggleBtn');
            panel.classList.toggle('show');
            btn.classList.toggle('active');
            renderNotes();
        }

        // åˆ‡æ¢æœç´¢é¢æ¿æ˜¾ç¤º
        function toggleSearch() {
            const panel = document.getElementById('searchPanel');
            const btn = document.getElementById('searchToggleBtn');
            panel.classList.toggle('show');
            btn.classList.toggle('active');
            if (panel.classList.contains('show')) {
                document.getElementById('searchInput').focus();
            }
        }

        // æ¸²æŸ“ç¬”è®°åˆ—è¡¨
        function renderNotes() {
            const notesContent = document.getElementById('notesContent');
            const lessonNotes = notes[currentLesson] || [];

            let html = '';
            if (lessonNotes.length === 0) {
                html += `
                    <div class="no-notes">
                        <div class="no-notes-icon">ğŸ“</div>
                        <div>è¿˜æ²¡æœ‰ç¬”è®°å“¦~</div>
                        <div style="font-size: 0.85rem; margin-top: 10px;">åœ¨ä¸‹æ–¹æ·»åŠ ç¬”è®°</div>
                    </div>
                `;
            } else {
                html += lessonNotes.map(note => `
                    <div class="note-item">
                        <div class="note-meta">
                            <span>ğŸ“… ${new Date(note.timestamp).toLocaleString('zh-CN')}</span>
                        </div>
                        <div class="note-text">${note.text}</div>
                        <div class="note-actions">
                            <button class="note-btn note-btn-edit" onclick="editNote('${note.id}')">âœï¸ ç¼–è¾‘</button>
                            <button class="note-btn note-btn-delete" onclick="deleteNote('${note.id}')">ğŸ—‘ï¸ åˆ é™¤</button>
                        </div>
                    </div>
                `).join('');
            }

            // å§‹ç»ˆæ˜¾ç¤ºæ·»åŠ ç¬”è®°è¡¨å•
            html += `
                <div class="note-form" id="noteForm">
                    <textarea class="note-textarea" id="noteInput" placeholder="è¾“å…¥ä½ çš„å­¦ä¹ ç¬”è®°..."></textarea>
                    <div class="note-form-actions">
                        <button class="note-btn-save" onclick="saveNote()">ğŸ’¾ ä¿å­˜ç¬”è®°</button>
                        <button class="note-btn-cancel" onclick="cancelNoteEdit()">å–æ¶ˆ</button>
                    </div>
                </div>
            `;

            notesContent.innerHTML = html;
        }

        // ä¿å­˜ç¬”è®°
        function saveNote() {
            const noteInput = document.getElementById('noteInput');
            const text = noteInput.value.trim();

            if (!text) {
                alert('è¯·è¾“å…¥ç¬”è®°å†…å®¹');
                return;
            }

            if (!notes[currentLesson]) {
                notes[currentLesson] = [];
            }

            if (editingNoteId) {
                // ç¼–è¾‘ç°æœ‰ç¬”è®°
                const note = notes[currentLesson].find(n => n.id === editingNoteId);
                if (note) {
                    note.text = text;
                    note.timestamp = Date.now();
                }
                editingNoteId = null;
            } else {
                // æ·»åŠ æ–°ç¬”è®°
                notes[currentLesson].push({
                    id: 'note-' + Date.now(),
                    text: text,
                    timestamp: Date.now()
                });
            }

            saveNotes();
            renderNotes();
        }

        // ç¼–è¾‘ç¬”è®°
        function editNote(noteId) {
            const note = notes[currentLesson].find(n => n.id === noteId);
            if (!note) return;

            editingNoteId = noteId;
            const noteInput = document.getElementById('noteInput');
            noteInput.value = note.text;
            noteInput.focus();
        }

        // åˆ é™¤ç¬”è®°
        function deleteNote(noteId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¬”è®°å—ï¼Ÿ')) return;

            notes[currentLesson] = notes[currentLesson].filter(n => n.id !== noteId);
            saveNotes();
            renderNotes();
        }

        // å–æ¶ˆç¼–è¾‘
        function cancelNoteEdit() {
            editingNoteId = null;
            const noteInput = document.getElementById('noteInput');
            noteInput.value = '';
        }

        // ä¿å­˜å­¦ä¹ æ—¶é—´
        function saveStudyTimes() {
            localStorage.setItem('studyTimes', JSON.stringify(studyTimes));
            localStorage.setItem('totalTimeSpent', totalTimeSpent.toString());
        }

        // åˆ‡æ¢è®¡æ—¶å™¨
        function toggleTimer() {
            if (studyStartTime === null) {
                // å¼€å§‹è®¡æ—¶
                studyStartTime = Date.now();
                updateTimerButton(true);
                startTimerUpdate();
            } else {
                // æš‚åœè®¡æ—¶å¹¶ä¿å­˜
                stopStudyTimer();
                updateTimerButton(false);
                stopTimerUpdate();
            }
        }

        // æ›´æ–°è®¡æ—¶æŒ‰é’®çŠ¶æ€
        function updateTimerButton(isRunning) {
            const timerBtn = document.getElementById('timerBtn');
            if (timerBtn) {
                if (isRunning) {
                    timerBtn.textContent = 'â¸ æš‚åœ';
                    timerBtn.classList.add('active');
                } else {
                    timerBtn.textContent = 'â–¶ å¼€å§‹';
                    timerBtn.classList.remove('active');
                }
            }
        }

        // æ›´æ–°è®¡æ—¶æ˜¾ç¤º
        let timerUpdateInterval = null;

        function startTimerUpdate() {
            stopTimerUpdate();
            timerUpdateInterval = setInterval(updateTimerDisplay, 1000);
            updateTimerDisplay();
        }

        function stopTimerUpdate() {
            if (timerUpdateInterval) {
                clearInterval(timerUpdateInterval);
                timerUpdateInterval = null;
            }
        }

        function updateTimerDisplay() {
            const timerStatus = document.getElementById('timerStatus');
            if (!timerStatus) return;

            // è®¡ç®—å½“å‰è¯¾ç¨‹çš„æ€»å­¦ä¹ æ—¶é—´ï¼ˆå·²ä¿å­˜ + å½“å‰ä¼šè¯ï¼‰
            let totalTime = studyTimes[currentLesson] || 0;
            if (studyStartTime !== null) {
                const currentSession = Math.floor((Date.now() - studyStartTime) / 1000);
                totalTime += currentSession;
            }

            timerStatus.textContent = `æ€»å­¦ä¹ : ${formatTime(totalTime)}`;
        }

        // å¼€å§‹è®¡æ—¶
        function startStudyTimer() {
            if (studyStartTime === null) {
                studyStartTime = Date.now();
            }
        }

        // åœæ­¢è®¡æ—¶å¹¶ä¿å­˜
        function stopStudyTimer() {
            if (studyStartTime !== null && currentLesson !== null) {
                const elapsed = Math.floor((Date.now() - studyStartTime) / 1000);
                if (elapsed > 0) {
                    if (!studyTimes[currentLesson]) {
                        studyTimes[currentLesson] = 0;
                    }
                    studyTimes[currentLesson] += elapsed;
                    totalTimeSpent += elapsed;
                    saveStudyTimes();
                    updateTotalTime();
                    renderSidebar(); // æ›´æ–°æ˜¾ç¤º
                }
                studyStartTime = null;
            }
        }

        // ä¿å­˜å®ŒæˆçŠ¶æ€åˆ° localStorage
        function saveCompletedState() {
            localStorage.setItem('completedLessons', JSON.stringify([...completedLessons]));
        }

        // åˆ‡æ¢å®ŒæˆçŠ¶æ€
        function toggleComplete(id, event) {
            event.stopPropagation();
            if (completedLessons.has(id)) {
                completedLessons.delete(id);
            } else {
                completedLessons.add(id);
            }
            saveCompletedState();
            renderSidebar();
            updateProgress();

            if (currentLesson === id) {
                updateContentHeader(id);
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const total = lessons.length;
            const completed = completedLessons.size;
            const percentage = Math.round((completed / total) * 100);

            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage + '%';

            if (percentage === 0) {
                progressText.textContent = 'åŠ æ²¹ï¼å¼€å§‹ä½ çš„å­¦ä¹ ä¹‹æ—…å§~ ğŸ’ª';
            } else if (percentage < 30) {
                progressText.textContent = 'ä¸é”™çš„å¼€å§‹ï¼ç»§ç»­ä¿æŒï¼ğŸŒ±';
            } else if (percentage < 60) {
                progressText.textContent = 'å·²ç»å®Œæˆäº†ä¸€åŠï¼åŠ æ²¹ï¼ğŸ’ª';
            } else if (percentage < 100) {
                progressText.textContent = 'å¿«è¦å®Œæˆäº†ï¼æœ€åå†²åˆºï¼ğŸ”¥';
            } else {
                progressText.textContent = 'ğŸ‰ æ­å–œï¼ä½ å·²ç»å®Œæˆäº†æ‰€æœ‰è¯¾ç¨‹ï¼å¤ªæ£’äº†ï¼ ğŸ‰';
            }
        }

        // æ›´æ–°å†…å®¹æ ‡é¢˜æ 
        function updateContentHeader(id) {
            const lesson = lessons.find(l => l.id === id);
            if (!lesson) return;

            const isCompleted = completedLessons.has(id);
            const btnClass = isCompleted ? 'completed' : '';
            const btnText = isCompleted ? 'å·²å®Œæˆ' : 'æ ‡è®°å®Œæˆ';

            const isTimerRunning = studyStartTime !== null;
            const timerBtnClass = isTimerRunning ? 'active' : '';
            const timerBtnText = isTimerRunning ? 'æš‚åœè®¡æ—¶' : 'å¼€å§‹è®¡æ—¶';

            document.getElementById('contentHeader').innerHTML = `
                <div class="content-left">
                    <span class="content-emoji">${lesson.emoji}</span>
                    <span class="content-title">${lesson.title}</span>
                </div>
                <div class="timer-controls">
                    <span class="timer-status" id="timerStatus">æ€»å­¦ä¹ : ${formatTime(studyTimes[id] || 0)}</span>
                    <button class="timer-btn ${timerBtnClass}" onclick="toggleTimer()" id="timerBtn">${timerBtnText}</button>
                    <button class="mark-complete-btn ${btnClass}" onclick="toggleComplete('${id}', event)">${btnText}</button>
                </div>
            `;
        }

        // ç®€å• Markdown è§£æ
        function parseMarkdown(md, lessonId) {
            let html = md;
            html = html.replace(/```(\w*)\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
            html = html.replace(/^#### (.*$)/gim, '<h4 id="heading-' + lessonId + '-3">$1</h4>');
            html = html.replace(/^### (.*$)/gim, '<h3 id="heading-' + lessonId + '-2">$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2 id="heading-' + lessonId + '-1">$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1 id="heading-' + lessonId + '-0">$1</h1>');
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*([^*]+)\*/g, '<em>$1</em>');
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
            html = html.replace(/^\- (.*$)/gim, '<li>$1</li>');
            html = html.replace(/^(\d+)\. (.*$)/gim, '<li>$2</li>');
            html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
            html = html.replace(/\n\n/g, '</p><p>');
            html = '<p>' + html + '</p>';
            html = html.replace(/<p><h([1234])>/g, '<h$1>');
            html = html.replace(/<\/h([1234])><\/p>/g, '</h$1>');
            html = html.replace(/<p><pre>/g, '<pre>');
            html = html.replace(/<\/pre><\/p>/g, '</pre>');
            html = html.replace(/<p><ul>/g, '<ul>');
            html = html.replace(/<\/ul><\/p>/g, '</ul>');
            html = html.replace(/<p><\/p>/g, '');
            return html;
        }

        // é«˜äº®æœç´¢å…³é”®è¯
        function highlightSearchTerm(text, term) {
            if (!term) return text;
            const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        // æœç´¢åŠŸèƒ½
        async function performSearch(query) {
            const resultsContainer = document.getElementById('searchResults');

            if (!query || query.length < 2) {
                resultsContainer.innerHTML = '';
                return;
            }

            resultsContainer.innerHTML = '<div class="search-loading">ğŸ” æœç´¢ä¸­...</div>';

            const results = [];
            const queryLower = query.toLowerCase();

            // æœç´¢è¯¾ç¨‹æ ‡é¢˜
            for (const lesson of lessons) {
                if (lesson.title.toLowerCase().includes(queryLower)) {
                    results.push({
                        lesson: lesson,
                        type: 'title',
                        title: lesson.title,
                        match: lesson.title
                    });
                }
            }

            // æœç´¢è¯¾ç¨‹å†…å®¹
            for (const lesson of lessons) {
                try {
                    // å¦‚æœå†…å®¹å·²ç¼“å­˜ï¼Œä½¿ç”¨ç¼“å­˜
                    let content = lessonContents[lesson.id];

                    if (!content) {
                        const res = await fetch(lesson.file);
                        content = await res.text();
                        lessonContents[lesson.id] = content;
                    }

                    // ç§»é™¤markdownæ ‡è®°è¿›è¡Œæœç´¢
                    const plainText = content
                        .replace(/```[\s\S]*?```/g, '')
                        .replace(/`[^`]+`/g, '')
                        .replace(/[#*_\[\]]/g, '')
                        .replace(/\n+/g, ' ')
                        .trim();

                    if (plainText.toLowerCase().includes(queryLower)) {
                        // æ‰¾åˆ°åŒ¹é…ä½ç½®å‘¨å›´çš„æ–‡æœ¬
                        const index = plainText.toLowerCase().indexOf(queryLower);
                        const start = Math.max(0, index - 30);
                        const end = Math.min(plainText.length, index + query.length + 30);
                        let snippet = plainText.substring(start, end);

                        if (start > 0) snippet = '...' + snippet;
                        if (end < plainText.length) snippet = snippet + '...';

                        results.push({
                            lesson: lesson,
                            type: 'content',
                            title: lesson.title,
                            match: snippet
                        });
                    }
                } catch (err) {
                    console.error('Error loading lesson for search:', err);
                }
            }

            // æ˜¾ç¤ºæœç´¢ç»“æœ
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="search-no-results">æœªæ‰¾åˆ°åŒ¹é…çš„å†…å®¹ ğŸ˜•</div>';
            } else {
                resultsContainer.innerHTML = results.slice(0, 10).map(result => `
                    <div class="search-result-item" onclick="loadLesson('${result.lesson.id}'); toggleSearch();">
                        <div class="search-result-title">${highlightSearchTerm(result.title, query)}</div>
                        <div class="search-result-lesson">${result.lesson.emoji} ${result.type === 'title' ? 'æ ‡é¢˜åŒ¹é…' : 'å†…å®¹åŒ¹é…'}</div>
                        ${result.type === 'content' ? `<div style="margin-top: 4px; font-size: 0.85rem; color: #666;">${highlightSearchTerm(result.match, query)}</div>` : ''}
                    </div>
                `).join('');
            }
        }

        // æœç´¢è¾“å…¥äº‹ä»¶
        document.getElementById('searchInput').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                performSearch(e.target.value.trim());
            }, 300);
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            // Ctrl+K æˆ– / - åˆ‡æ¢æœç´¢é¢æ¿
            if ((e.ctrlKey && e.key === 'k') || e.key === '/') {
                e.preventDefault();
                toggleSearch();
            }
            // Ctrl+M - åˆ‡æ¢ç¬”è®°é¢æ¿
            if (e.ctrlKey && e.key === 'm') {
                e.preventDefault();
                toggleNotes();
            }
            // Ctrl+L - åˆ‡æ¢ç›®å½•é¢æ¿
            if (e.ctrlKey && e.key === 'l') {
                e.preventDefault();
                toggleTOC();
            }
            // Escape - å…³é—­æ‰€æœ‰é¢æ¿
            if (e.key === 'Escape') {
                const searchPanel = document.getElementById('searchPanel');
                const notesPanel = document.getElementById('notesPanel');
                const tocPanel = document.getElementById('tocPanel');
                if (searchPanel.classList.contains('show')) {
                    toggleSearch();
                } else if (notesPanel.classList.contains('show')) {
                    toggleNotes();
                } else if (tocPanel.classList.contains('show')) {
                    toggleTOC();
                }
            }
        });

        // ç‚¹å‡»å¤–éƒ¨å…³é—­é¢æ¿
        document.addEventListener('click', (e) => {
            const searchPanel = document.getElementById('searchPanel');
            const searchBtn = document.getElementById('searchToggleBtn');
            const notesPanel = document.getElementById('notesPanel');
            const notesBtn = document.getElementById('notesToggleBtn');
            const tocPanel = document.getElementById('tocPanel');
            const tocBtn = document.getElementById('tocToggleBtn');

            // å…³é—­æœç´¢é¢æ¿
            if (searchPanel.classList.contains('show') &&
                !searchPanel.contains(e.target) &&
                !searchBtn.contains(e.target)) {
                toggleSearch();
            }

            // å…³é—­ç¬”è®°é¢æ¿
            if (notesPanel.classList.contains('show') &&
                !notesPanel.contains(e.target) &&
                !notesBtn.contains(e.target)) {
                toggleNotes();
            }

            // å…³é—­ç›®å½•é¢æ¿
            if (tocPanel.classList.contains('show') &&
                !tocPanel.contains(e.target) &&
                !tocBtn.contains(e.target)) {
                toggleTOC();
            }
        });

        // åŠ è½½è¯¾ç¨‹å†…å®¹
        async function loadLesson(id) {
            // åœæ­¢è®¡æ—¶æ›´æ–°å¹¶ä¿å­˜ä¹‹å‰çš„è¯¾ç¨‹æ—¶é—´
            stopTimerUpdate();
            stopStudyTimer();

            const lesson = lessons.find(l => l.id === id);
            if (!lesson) return;

            currentLesson = id;

            // ç§»é™¤ä¹‹å‰çš„æ»šåŠ¨ç›‘å¬
            if (tocObserver) {
                tocObserver.disconnect();
            }

            document.querySelectorAll('.lesson-item').forEach(el => el.classList.remove('active'));
            const lessonItem = document.querySelector(`[data-id="${id}"]`);
            if (lessonItem) {
                lessonItem.classList.add('active');
            }

            updateContentHeader(id);
            document.getElementById('contentBody').innerHTML = '<div class="loading">â³ åŠ è½½ä¸­...</div>';
            document.getElementById('tocPanel').classList.remove('show');

            try {
                if (loadedLessons.has(id)) {
                    const cached = localStorage.getItem('lesson-' + id);
                    if (cached) {
                        document.getElementById('contentBody').innerHTML = cached;
                        generateTOC(cached, id);
                        // æ·»åŠ æ»šåŠ¨ç›‘å¬
                        setTimeout(() => {
                            observeContentScroll();
                        }, 100);

                        // åŠ è½½ç¬”è®°
                        renderNotes();

                        return;
                    }
                }

                console.log('Loading:', lesson.file);
                const res = await fetch(lesson.file);
                const md = await res.text();
                const html = parseMarkdown(md, id);

                document.getElementById('contentBody').innerHTML = html;
                localStorage.setItem('lesson-' + id, html);
                loadedLessons.add(id);
                lessonContents[id] = md;

                // ç”Ÿæˆç›®å½•
                generateTOC(html, id);

                // æ·»åŠ æ»šåŠ¨ç›‘å¬
                observeContentScroll();

                // åŠ è½½ç¬”è®°
                renderNotes();
            } catch (err) {
                document.getElementById('contentBody').innerHTML = '<p style="color:red;text-align:center;padding:50px;">âŒ åŠ è½½å¤±è´¥: ' + err.message + '</p>';
                console.error(err);
            }
        }

        // ç›‘å¬å†…å®¹æ»šåŠ¨
        function observeContentScroll() {
            const contentBody = document.getElementById('contentBody');
            if (!contentBody) return;

            let ticking = false;
            contentBody.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(() => {
                        updateActiveTOC();
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        }

        // æ¸²æŸ“ä¾§è¾¹æ 
        function renderSidebar() {
            const day1 = lessons.slice(0, 6);
            const day2 = lessons.slice(6);

            const renderDay = (dayLessons, emoji, title) => `
                <div class="day-section">
                    <div class="day-header">
                        <span class="day-emoji">${emoji}</span>
                        <span class="day-title">${title}</span>
                    </div>
                    ${dayLessons.map(l => {
                        const isCompleted = completedLessons.has(l.id);
                        const time = studyTimes[l.id] || 0;
                        return `
                        <div class="lesson-item" data-id="${l.id}">
                            <div class="lesson-header" onclick="loadLesson('${l.id}')">
                                <span class="lesson-emoji">${l.emoji}</span>
                                <span class="lesson-title">${l.title}</span>
                                <div class="lesson-actions">
                                    ${time > 0 ? `<span class="study-time">â± ${formatTime(time)}</span>` : ''}
                                    <button class="complete-btn ${isCompleted ? 'completed' : ''}"
                                            onclick="toggleComplete('${l.id}', event)"
                                            title="${isCompleted ? 'æ ‡è®°ä¸ºæœªå®Œæˆ' : 'æ ‡è®°ä¸ºå®Œæˆ'}">
                                        ${isCompleted ? 'âœ“' : 'â—‹'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    `}).join('')}
                </div>
            `;

            document.getElementById('lessonList').innerHTML = renderDay(day1, 'ğŸŒ…', 'Day 1: åŸºç¡€åŠŸèƒ½') + renderDay(day2, 'ğŸš€', 'Day 2: é«˜çº§åŠŸèƒ½');
        }

        // ç›®å½•ç›¸å…³å˜é‡
        let tocItems = [];
        let tocObserver = null;

        // åˆ‡æ¢ç›®å½•æ˜¾ç¤º
        function toggleTOC() {
            const panel = document.getElementById('tocPanel');
            const btn = document.getElementById('tocToggleBtn');
            panel.classList.toggle('show');
            btn.classList.toggle('active');
        }

        // ç”Ÿæˆç›®å½•
        function generateTOC(html, lessonId) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const headers = doc.querySelectorAll('h1, h2, h3, h4');

            tocItems = [];
            const tocContent = document.getElementById('tocContent');

            if (headers.length === 0) {
                tocContent.innerHTML = '<div style="padding: 15px; text-align: center; color: #999;">æ­¤è¯¾ç¨‹æ— ç›®å½•</div>';
                return;
            }

            let tocHTML = '';
            headers.forEach((header, index) => {
                const level = parseInt(header.tagName.substring(1));
                const text = header.textContent.trim();
                const id = `heading-${lessonId}-${index}`;

                tocItems.push({ id, level, element: header });

                tocHTML += `
                    <div class="toc-item toc-level-${Math.min(level, 3)}"
                         data-id="${id}"
                         data-level="${level}"
                         onclick="scrollToHeading('${id}')">
                        ${text}
                    </div>
                `;
            });

            tocContent.innerHTML = tocHTML;
        }

        // æ»šåŠ¨åˆ°æ ‡é¢˜
        function scrollToHeading(id) {
            const element = document.getElementById(id);
            const contentBody = document.getElementById('contentBody');
            if (element && contentBody) {
                // è®¡ç®—å…ƒç´ åœ¨å®¹å™¨ä¸­çš„ä½ç½®
                const topPos = element.offsetTop - 20;
                contentBody.scrollTo({
                    top: topPos,
                    behavior: 'smooth'
                });
            }
        }

        // æ›´æ–°æ¿€æ´»çš„ç›®å½•é¡¹
        function updateActiveTOC() {
            const contentBody = document.getElementById('contentBody');
            if (!contentBody) return;

            const scrollPosition = contentBody.scrollTop + 100;
            let activeItem = null;

            for (const item of tocItems) {
                // æ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨å½“å‰å†…å®¹ä¸­
                const element = document.getElementById(item.id);
                if (element && element.offsetParent !== null) {
                    const elementTop = element.offsetTop;
                    if (elementTop <= scrollPosition) {
                        activeItem = item;
                    } else {
                        break;
                    }
                }
            }

            // æ›´æ–°æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.toc-item').forEach(el => {
                el.classList.remove('active');
            });
            if (activeItem) {
                const activeEl = document.querySelector(`.toc-item[data-id="${activeItem.id}"]`);
                if (activeEl) {
                    activeEl.classList.add('active');
                    // ç¡®ä¿æ¿€æ´»é¡¹å¯è§
                    activeEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }

        // é¡µé¢ç¦»å¼€æ—¶ä¿å­˜å­¦ä¹ æ—¶é—´
        window.addEventListener('beforeunload', () => {
            stopStudyTimer();
        });

        // é¡µé¢éšè—æ—¶æš‚åœè®¡æ—¶å¹¶ä¿å­˜
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // ä»…åœ¨è®¡æ—¶å™¨è¿è¡Œæ—¶åœæ­¢å¹¶ä¿å­˜
                if (studyStartTime !== null) {
                    stopStudyTimer();
                    updateTimerButton(false);
                    stopTimerUpdate();
                }
            }
        });

        // åˆå§‹åŒ–
        loadCompletedState();
        renderSidebar();
    </script>
</body>
</html>
