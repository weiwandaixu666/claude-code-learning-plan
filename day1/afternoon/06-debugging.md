# Day 1 下午 - 6. 调试与问题解决

预计时间：1小时

## 📚 学习目标

- [ ] 掌握错误诊断和分析方法
- [ ] 学习日志分析技巧
- [ ] 理解性能问题排查流程
- [ ] 完成实际练习：引入并修复 bug

## 🐛 第一步：错误诊断与分析

### 错误类型识别

1. **语法错误**：代码不符合语言规则
2. **运行时错误**：执行时发生的错误
3. **逻辑错误**：代码运行但结果不正确
4. **类型错误**：数据类型不匹配
5. **异步错误**：Promise、回调相关错误

### 诊断流程

**标准诊断步骤：**

```
任务：诊断错误

1. 读取 exercises/buggy-code.py
2. 识别所有错误类型
3. 分析每个错误的原因
4. 提出修复方案
5. 说明如何预防类似错误
```

### 练习 1: 错误识别

```
任务：找 Bug 游戏

1. 读取 exercises/buggy-code.py
2. 不要运行代码，仅通过阅读找出所有 bug
3. 列出每个 bug 的：
   - 位置（行号）
   - 类型
   - 严重程度
   - 可能的影响
   - 修复建议

挑战：找出至少 5 个问题！
```

### 练习 2: 错误修复

```
任务：修复所有 Bug

1. 使用之前练习中识别的 bug 列表
2. 按优先级逐个修复
3. 每次修复后：
   - 解释为什么这样修复
   - 说明是否会影响其他代码
   - 是否需要添加测试
4. 完成后验证所有功能
5. 生成修复报告
```

## 📊 第二步：日志分析

### 日志级别

- **DEBUG**: 详细的调试信息
- **INFO**: 一般信息
- **WARN**: 警告信息
- **ERROR**: 错误信息
- **FATAL**: 致命错误

### 分析技巧

**查找错误模式：**

```
在项目目录中搜索：
1. 所有的 console.error 或 logger.error
2. 所有的 TODO 和 FIXME 注释
3. 所有的 throw 语句
4. 所有的 catch 块
```

### 练习 3: 添加日志系统

```
任务：实现日志系统

为 exercises/sample-code.js 添加完整的日志系统：

1. 创建 logger.js 模块，包含：
   - 不同级别的日志方法
   - 日志格式化
   - 时间戳
   - 输出到文件（可选）

2. 在主要函数中添加适当的日志：
   - 函数入口（DEBUG）
   - 重要参数（DEBUG）
   - 关键操作（INFO）
   - 潜在问题（WARN）
   - 错误（ERROR）

3. 添加使用示例
```

### 练习 4: 日志分析实战

```
任务：分析日志文件

1. 创建 exercises/logs/app.log
2. 填充示例日志（包含各种级别）
3. 让 Claude Code 分析：
   - 统计每种级别的日志数量
   - 找出所有错误信息
   - 识别重复出现的问题
   - 分析时间模式
   - 提出改进建议

创建一个日志分析脚本自动化这个过程。
```

## ⚡ 第三步：性能问题排查

### 常见性能问题

1. **N+1 查询**：数据库查询问题
2. **内存泄漏**：未释放的资源
3. **死循环**：无限或低效循环
4. **过度渲染**：前端性能问题
5. **阻塞操作**：同步 I/O 操作

### 性能分析工具

```
# Node.js
node --prof script.js
node --prof-process isolate-*.log > processed.txt

# Python
import cProfile
cProfile.run('function()')

# 浏览器
开发者工具 > Performance
```

### 练习 5: 性能分析

```
任务：性能瓶颈分析

1. 读取 exercises/slow-code.js
2. 识别性能问题：
   - 找出时间复杂度高的算法
   - 识别不必要的计算
   - 发现内存使用问题
3. 创建性能测试：
   - 测量执行时间
   - 测量内存使用
   - 创建性能基准
4. 优化代码
5. 对比优化前后的性能
6. 生成性能报告
```

### 练习 6: 内存泄漏排查

```
任务：检测内存泄漏

创建 exercises/memory-leak.js，包含：

1. 常见的内存泄漏模式：
   - 未清除的定时器
   - 未释放的事件监听器
   - 闭包引用
   - 全局变量累积

2. 然后创建内存泄漏检测工具：
   - 监控堆内存使用
   - 识别增长模式
   - 生成泄漏报告

3. 修复所有内存泄漏问题
```

## 🔍 第四步：调试技巧

### 策略性调试

**二分法调试：**

```
代码有 bug 但不知道在哪里？

1. 在中间位置添加日志
2. 确定问题在前半还是后半
3. 重复这个过程
4. 快速定位问题
```

**假设验证：**

```
1. 提出假设："可能是 X 导致的"
2. 设计验证实验
3. 收集证据
4. 确认或否定假设
5. 调整假设，继续验证
```

### 练习 7: 系统化调试

```
任务：调试未知问题

1. 读取 exercises/mystery-bug.js
2. 不运行代码，仅通过分析：
   - 列出所有可能导致问题的代码
   - 为每个可能性分配概率
   - 设计验证策略
3. 逐个验证假设
4. 找到真正的问题
5. 修复并验证
6. 记录调试过程
```

## 🎯 第五步：综合调试练习

### 练习 8: 完整调试流程

```
任务：从零开始的调试

步骤：

1. 复现问题
   - 运行 exercises/app-with-bug.js
   - 观察错误信息
   - 记录问题表现

2. 收集信息
   - 阅读相关代码
   - 查看日志
   - 检查依赖版本

3. 形成假设
   - 列出可能原因
   - 按概率排序

4. 验证假设
   - 添加日志
   - 使用断点
   - 运行测试

5. 修复问题
   - 实施修复
   - 验证修复
   - 回归测试

6. 预防措施
   - 添加测试
   - 改进文档
   - 更新最佳实践

完成整个流程并生成调试报告。
```

### 练习 9: 引入并修复 Bug

```
任务：Bug 修复工作流

1. 创建一个简单的计算器程序
2. 故意引入 3 个不同类型的 bug：
   - 1 个语法错误
   - 1 个逻辑错误
   - 1 个边界条件错误

3. 让另一个同学（或未来的你）来修复：
   - 只看错误信息
   - 使用调试工具
   - 记录修复过程

4. 交换角色，练习识别和修复
```

## 📋 检查点

在继续之前，确保你：

- [ ] 能够识别和诊断各种类型的错误
- [ ] 掌握日志分析的方法
- [ ] 理解性能问题排查流程
- [ ] 能够系统化地调试问题
- [ ] 完成了至少 3 个练习

## 💡 最佳实践

### 错误处理原则

```javascript
// ✅ 好的错误处理
try {
  const result = await riskyOperation();
  return result;
} catch (error) {
  logger.error('Operation failed', {
    error: error.message,
    stack: error.stack,
    context: { userId, action }
  });
  throw new CustomError('Operation failed', error);
}

// ❌ 不好的错误处理
try {
  const result = await riskyOperation();
  return result;
} catch (e) {
  console.log(e);
}
```

### 调试清单

- [ ] 错误信息是什么？
- [ ] 何时发生错误？
- [ ] 在什么环境下发生？
- [ ] 最近的代码更改？
- [ ] 是否有相关日志？
- [ ] 能否稳定复现？
- [ ] 是否是已知问题？

## 🚀 Day 1 总结

恭喜！你完成了 Day 1 的所有课程。今天你学习了：

✅ 上午
- 环境安装与配置
- 基础对话与文件操作
- 代码编辑基础

✅ 下午
- Bash 工具与命令执行
- 智能代码生成与重构
- 调试与问题解决

## 📝 我的笔记

```bash
# 调试命令备忘

# Node.js 调试
node inspect script.js

# Python 调试
python -m pdb script.py

# 日志查看
tail -f logs/app.log
grep ERROR logs/app.log

# 性能分析
time node script.js
```

## 🎓 Day 2 预告

明天你将学习：

- 多文件操作与项目管理
- Task 工具与代理系统
- MCP 服务器与扩展功能
- 技能与自定义命令
- Plan 模式与复杂任务
- 综合实战项目

**做好准备**：休息好，明天将是更高级的内容！

## 🏆 Day 1 成就解锁

- [ ] 🎖️ Claude Code 新手
- [ ] 🔧 代码编辑者
- [ ] 🐛 Bug 猎手
- [ ] 📝 Git 大师
- [ ] 🚀 代码生成者
- [ ] 🔍 调试专家

**恭喜完成 Day 1！** 🎉
